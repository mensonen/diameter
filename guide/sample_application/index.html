
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../application/">
      
      
        <link rel="next" href="../../api/message_avp/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.2">
    
    
      
        <title>Sample application - Python Diameter Stack</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
    

    
        <style>
            .md-sidebar .md-nav__list .md-nav__list  .md-nav { display: none }
        </style>
    

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#a-sample-application" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Python Diameter Stack" class="md-header__button md-logo" aria-label="Python Diameter Stack" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Python Diameter Stack
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Sample application
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mensonen/diameter" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Python Diameter Stack" class="md-nav__button md-logo" aria-label="Python Diameter Stack" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Python Diameter Stack
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mensonen/diameter" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../avp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Working with AVPs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../message/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Working with messages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../node/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Connecting to peers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../application/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Sample application
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Sample application
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setting-up-logging" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up logging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-diameter-node" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a diameter node
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-the-charging-application" class="md-nav__link">
    <span class="md-ellipsis">
      Creating the charging application
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#constructing-a-charging-request" class="md-nav__link">
    <span class="md-ellipsis">
      Constructing a charging request
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sending-the-message" class="md-nav__link">
    <span class="md-ellipsis">
      Sending the message
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sending the message">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-complete-script" class="md-nav__link">
    <span class="md-ellipsis">
      The complete script
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Refrence
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Refrence
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/message_avp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AVP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/message/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Message
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Commands
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Commands
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/commands/aa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/commands/aa_mobile_node/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AA Mobile Node
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/commands/abort_session/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Abort Session
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/commands/accounting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accounting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/commands/capabilities_exchange/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Capabilities Exchange
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/commands/credit_control/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Credit Control
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/commands/device_watchdog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Device Watchdog
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/commands/diameter_eap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Diameter EAP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/commands/disconnect_peer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Disconnect Peer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/commands/re_auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Re Auth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/commands/session_termination/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Session Termination
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/commands/other_commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Other
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/node/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/peer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Peer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/application/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/utilities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node utilities
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="a-sample-application">A sample application<a class="headerlink" href="#a-sample-application" title="Permanent link">&para;</a></h1>
<p>This section goes through the <code>"examples/credit_control_sms_client.py"</code> file,
which demonstrates how to build a diameter client that performs a single SMS
charging request.</p>
<h2 id="setting-up-logging">Setting up logging<a class="headerlink" href="#setting-up-logging" title="Permanent link">&para;</a></h2>
<p>All parts of the diameter stack use logging extensively. For the purposes of
this example, the logs will be dumped in the console.</p>
<div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="kn">import</span> <span class="nn">logging</span>
</span><span id="__span-0-2">
</span><span id="__span-0-3"><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(name)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-4"><span class="c1"># this shows a human-readable message dump in the logs</span>
</span><span id="__span-0-5"><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;diameter.peer.msg&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</span><span id="__span-0-6"><span class="c1"># this silences periodic dumping of peer statistics</span>
</span><span id="__span-0-7"><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;diameter.stats&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span></code></pre></div>
<h2 id="creating-a-diameter-node">Creating a diameter node<a class="headerlink" href="#creating-a-diameter-node" title="Permanent link">&para;</a></h2>
<p>A node represents our own peer and is required for the connectivity to exist.
The node will be configured with one remote peer, which is the destination of
our charging request.</p>
<div class="highlight"><pre><span></span><code><span id="__span-1-1"><span class="kn">from</span> <span class="nn">diameter.message.constants</span> <span class="kn">import</span> <span class="o">*</span>
</span><span id="__span-1-2"><span class="kn">from</span> <span class="nn">diameter.node</span> <span class="kn">import</span> <span class="n">Node</span>
</span><span id="__span-1-3">
</span><span id="__span-1-4"><span class="c1"># Configure our client node</span>
</span><span id="__span-1-5"><span class="n">node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
</span><span id="__span-1-6">    <span class="s2">&quot;smsgw.gy&quot;</span><span class="p">,</span> <span class="s2">&quot;testrealm.local&quot;</span><span class="p">,</span>
</span><span id="__span-1-7">    <span class="n">vendor_ids</span><span class="o">=</span><span class="p">[</span><span class="n">VENDOR_ETSI</span><span class="p">,</span> <span class="n">VENDOR_TGPP</span><span class="p">,</span> <span class="n">VENDOR_TGPP2</span><span class="p">])</span>
</span><span id="__span-1-8"><span class="c1"># Add the destination peer</span>
</span><span id="__span-1-9"><span class="n">ocs_cfg</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">add_peer</span><span class="p">(</span>
</span><span id="__span-1-10">    <span class="s2">&quot;aaa://ocs.gy&quot;</span><span class="p">,</span> <span class="s2">&quot;testrealm.local&quot;</span><span class="p">,</span>
</span><span id="__span-1-11">    <span class="n">ip_addresses</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;10.0.0.50&quot;</span><span class="p">],</span> <span class="n">is_persistent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-1-12"><span class="n">node</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></code></pre></div>
<h2 id="creating-the-charging-application">Creating the charging application<a class="headerlink" href="#creating-the-charging-application" title="Permanent link">&para;</a></h2>
<p>As we are going to act only as a client, our application can be as simple as 
possible. An instance of <code>SimpleThreadingApplication</code> with no callback function
to receive messages is sufficient.</p>
<div class="highlight"><pre><span></span><code><span id="__span-2-1"><span class="kn">from</span> <span class="nn">diameter.message.constants</span> <span class="kn">import</span> <span class="o">*</span>
</span><span id="__span-2-2"><span class="kn">from</span> <span class="nn">diameter.node.application</span> <span class="kn">import</span> <span class="n">SimpleThreadingApplication</span>
</span><span id="__span-2-3">
</span><span id="__span-2-4"><span class="c1"># Configure our client application. Credit Control Applications advertise their</span>
</span><span id="__span-2-5"><span class="c1"># application ID in auth-application-id.</span>
</span><span id="__span-2-6"><span class="n">client</span> <span class="o">=</span> <span class="n">SimpleThreadingApplication</span><span class="p">(</span>
</span><span id="__span-2-7">    <span class="n">APP_DIAMETER_CREDIT_CONTROL_APPLICATION</span><span class="p">,</span>
</span><span id="__span-2-8">    <span class="n">is_auth_application</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-2-9"><span class="c1"># Add application for `ocs.gy` peer configured above</span>
</span><span id="__span-2-10"><span class="n">node</span><span class="o">.</span><span class="n">add_application</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="p">[</span><span class="n">ocs_cfg</span><span class="p">])</span>
</span></code></pre></div>
<p>If we were to act as a server and also expect incoming requests, a callback 
function should be passed for the <code>SimpleThreadingApplication</code> constructor.</p>
<h2 id="constructing-a-charging-request">Constructing a charging request<a class="headerlink" href="#constructing-a-charging-request" title="Permanent link">&para;</a></h2>
<p>The charging request will be an instance of <code>CreditControlRequest</code>. The header
values, e.g. the hop-by-hop identifier and the application ID will be set 
automatically by the application as the message is submitted, but everything 
else must be set manually.</p>
<p>This example uses multiple services credit control to specify the requested
units, which is a common approach. An alternative would be to provide the 
requested units directly as a value for the <code>ccr.requested_service_unit</code> 
attribute.</p>
<p>The example also appends a custom AVP structure at the end, containing TGPP
specified identifiers for an SMS submission, in our case the recipient address,
the message data coding scheme and the type of the short message being sent.</p>
<div class="highlight"><pre><span></span><code><span id="__span-3-1"><span class="kn">import</span> <span class="nn">datetime</span>
</span><span id="__span-3-2">
</span><span id="__span-3-3"><span class="kn">from</span> <span class="nn">diameter.message</span> <span class="kn">import</span> <span class="n">Avp</span>
</span><span id="__span-3-4"><span class="kn">from</span> <span class="nn">diameter.message.commands.credit_control</span> <span class="kn">import</span> <span class="n">CreditControlRequest</span>
</span><span id="__span-3-5"><span class="kn">from</span> <span class="nn">diameter.message.commands.credit_control</span> <span class="kn">import</span> <span class="n">RequestedServiceUnit</span>
</span><span id="__span-3-6"><span class="kn">from</span> <span class="nn">diameter.message.constants</span> <span class="kn">import</span> <span class="o">*</span>
</span><span id="__span-3-7">
</span><span id="__span-3-8"><span class="c1"># Construct a credit control request</span>
</span><span id="__span-3-9"><span class="n">ccr</span> <span class="o">=</span> <span class="n">CreditControlRequest</span><span class="p">()</span>
</span><span id="__span-3-10">
</span><span id="__span-3-11"><span class="c1"># These are required:</span>
</span><span id="__span-3-12"><span class="n">ccr</span><span class="o">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">session_generator</span><span class="o">.</span><span class="n">next_id</span><span class="p">()</span>
</span><span id="__span-3-13"><span class="n">ccr</span><span class="o">.</span><span class="n">origin_host</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">origin_host</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="__span-3-14"><span class="n">ccr</span><span class="o">.</span><span class="n">origin_realm</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">realm_name</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="__span-3-15"><span class="n">ccr</span><span class="o">.</span><span class="n">destination_realm</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">realm_name</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="__span-3-16"><span class="n">ccr</span><span class="o">.</span><span class="n">auth_application_id</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">application_id</span>
</span><span id="__span-3-17"><span class="n">ccr</span><span class="o">.</span><span class="n">service_context_id</span> <span class="o">=</span> <span class="s2">&quot;32274@3gpp.org&quot;</span>  <span class="c1"># SMS</span>
</span><span id="__span-3-18"><span class="n">ccr</span><span class="o">.</span><span class="n">cc_request_type</span> <span class="o">=</span> <span class="n">E_CC_REQUEST_TYPE_EVENT_REQUEST</span>
</span><span id="__span-3-19"><span class="n">ccr</span><span class="o">.</span><span class="n">cc_request_number</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-3-20">
</span><span id="__span-3-21"><span class="c1"># These are usually wanted by charging servers:</span>
</span><span id="__span-3-22"><span class="n">ccr</span><span class="o">.</span><span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;diameter&quot;</span>
</span><span id="__span-3-23"><span class="n">ccr</span><span class="o">.</span><span class="n">event_timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="__span-3-24"><span class="n">ccr</span><span class="o">.</span><span class="n">requested_action</span> <span class="o">=</span> <span class="n">E_REQUESTED_ACTION_DIRECT_DEBITING</span>
</span><span id="__span-3-25">
</span><span id="__span-3-26"><span class="n">ccr</span><span class="o">.</span><span class="n">add_subscription_id</span><span class="p">(</span>
</span><span id="__span-3-27">    <span class="n">subscription_id_type</span><span class="o">=</span><span class="n">E_SUBSCRIPTION_ID_TYPE_END_USER_E164</span><span class="p">,</span>
</span><span id="__span-3-28">    <span class="n">subscription_id_data</span><span class="o">=</span><span class="s2">&quot;41780000001&quot;</span><span class="p">)</span>
</span><span id="__span-3-29"><span class="n">ccr</span><span class="o">.</span><span class="n">add_multiple_services_credit_control</span><span class="p">(</span>
</span><span id="__span-3-30">    <span class="n">requested_service_unit</span><span class="o">=</span><span class="n">RequestedServiceUnit</span><span class="p">(</span><span class="n">cc_service_specific_units</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
</span><span id="__span-3-31">    <span class="n">service_identifier</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-3-32">
</span><span id="__span-3-33"><span class="c1"># Adds the following 3GPP vendor-specific AVP structure at the end, which</span>
</span><span id="__span-3-34"><span class="c1"># contains the SMS type and recipient. Looks like:</span>
</span><span id="__span-3-35"><span class="c1">#</span>
</span><span id="__span-3-36"><span class="c1">#   Service-Information &lt;Code: 0x369, Flags: 0xc0 (VM-), Length: 120, Vnd: TGPP&gt;</span>
</span><span id="__span-3-37"><span class="c1">#     SMS-Information &lt;Code: 0x7d0, Flags: 0x80 (V--), Length: 108, Vnd: TGPP&gt;</span>
</span><span id="__span-3-38"><span class="c1">#       Data-Coding-Scheme &lt;Code: 0x7d1, Flags: 0x80 (V--), Length: 16, Vnd: TGPP, Val: 8&gt;</span>
</span><span id="__span-3-39"><span class="c1">#       SM-Message-Type &lt;Code: 0x7d7, Flags: 0x80 (V--), Length: 16, Vnd: TGPP, Val: 0&gt;</span>
</span><span id="__span-3-40"><span class="c1">#       Recipient-Info &lt;Code: 0x7ea, Flags: 0x80 (V--), Length: 64, Vnd: TGPP&gt;</span>
</span><span id="__span-3-41"><span class="c1">#         Recipient-Address &lt;Code: 0x4b1, Flags: 0x80 (V--), Length: 52, Vnd: TGPP&gt;</span>
</span><span id="__span-3-42"><span class="c1">#           Address-Type &lt;Code: 0x383, Flags: 0xc0 (VM-), Length: 16, Vnd: TGPP, Val: 1&gt;</span>
</span><span id="__span-3-43"><span class="c1">#           Address-Data &lt;Code: 0x381, Flags: 0xc0 (VM-), Length: 23, Vnd: TGPP, Val: 41780000001&gt;</span>
</span><span id="__span-3-44"><span class="c1">#</span>
</span><span id="__span-3-45"><span class="c1"># Actual content wanted by the OCS on the receiving end may vary depending on</span>
</span><span id="__span-3-46"><span class="c1"># the vendor and their implementation.</span>
</span><span id="__span-3-47"><span class="n">ccr</span><span class="o">.</span><span class="n">append_avp</span><span class="p">(</span>
</span><span id="__span-3-48">    <span class="n">Avp</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">AVP_TGPP_SERVICE_INFORMATION</span><span class="p">,</span> <span class="n">VENDOR_TGPP</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-3-49">        <span class="n">Avp</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">AVP_TGPP_SMS_INFORMATION</span><span class="p">,</span> <span class="n">VENDOR_TGPP</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-3-50">            <span class="n">Avp</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">AVP_TGPP_DATA_CODING_SCHEME</span><span class="p">,</span> <span class="n">VENDOR_TGPP</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span>
</span><span id="__span-3-51">            <span class="n">Avp</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">AVP_TGPP_SM_MESSAGE_TYPE</span><span class="p">,</span> <span class="n">VENDOR_TGPP</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">E_SM_MESSAGE_TYPE_SUBMISSION</span><span class="p">),</span>
</span><span id="__span-3-52">            <span class="n">Avp</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">AVP_TGPP_RECIPIENT_INFO</span><span class="p">,</span> <span class="n">VENDOR_TGPP</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-3-53">                <span class="n">Avp</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">AVP_TGPP_RECIPIENT_ADDRESS</span><span class="p">,</span> <span class="n">VENDOR_TGPP</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-3-54">                    <span class="n">Avp</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">AVP_TGPP_ADDRESS_TYPE</span><span class="p">,</span> <span class="n">VENDOR_TGPP</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">E_ADDRESS_TYPE_MSISDN</span><span class="p">),</span>
</span><span id="__span-3-55">                    <span class="n">Avp</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">AVP_TGPP_ADDRESS_DATA</span><span class="p">,</span> <span class="n">VENDOR_TGPP</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;41780000001&quot;</span><span class="p">)</span>
</span><span id="__span-3-56">                <span class="p">]),</span>
</span><span id="__span-3-57">            <span class="p">]),</span>
</span><span id="__span-3-58">        <span class="p">])</span>
</span><span id="__span-3-59">    <span class="p">])</span>
</span><span id="__span-3-60"><span class="p">)</span>
</span></code></pre></div>
<h2 id="sending-the-message">Sending the message<a class="headerlink" href="#sending-the-message" title="Permanent link">&para;</a></h2>
<p>The constructed message will be sent through the application. Calling 
<code>wait_for_ready</code> before sending the first message is recommended, as our 
destination peer will not accept any messages until the capabilities exchange
procedure has been completed in the background. <code>wait_for_ready</code> will also 
block if the remote peer has gone away.</p>
<p>When sending a request through an application, the application will block 
until a given timeout (default 30 seconds) has passed, waiting for an answer to
arrive through the peer. If an answer is received, it is returned, otherwise an
exception is raised.</p>
<p>As we are only going to send one single message, the noed can be stopped 
afterwards, which will cleanly disconnect from the remote peer.</p>
<div class="highlight"><pre><span></span><code><span id="__span-4-1"><span class="c1"># Wait for CER/CEA to complete</span>
</span><span id="__span-4-2"><span class="n">client</span><span class="o">.</span><span class="n">wait_for_ready</span><span class="p">()</span>
</span><span id="__span-4-3"><span class="n">cca</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">send_request</span><span class="p">(</span><span class="n">ccr</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-4-4">
</span><span id="__span-4-5"><span class="c1"># Should print 2001, if all goes well</span>
</span><span id="__span-4-6"><span class="nb">print</span><span class="p">(</span><span class="n">cca</span><span class="o">.</span><span class="n">result_code</span><span class="p">)</span>
</span><span id="__span-4-7">
</span><span id="__span-4-8"><span class="c1"># Disconnect from peer and exit</span>
</span><span id="__span-4-9"><span class="n">node</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span></code></pre></div>
<hr />
<h3 id="the-complete-script">The complete script<a class="headerlink" href="#the-complete-script" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span id="__span-5-1"><span class="kn">import</span> <span class="nn">datetime</span>
</span><span id="__span-5-2"><span class="kn">import</span> <span class="nn">logging</span>
</span><span id="__span-5-3">
</span><span id="__span-5-4"><span class="kn">from</span> <span class="nn">diameter.message</span> <span class="kn">import</span> <span class="n">Avp</span>
</span><span id="__span-5-5"><span class="kn">from</span> <span class="nn">diameter.message.commands.credit_control</span> <span class="kn">import</span> <span class="n">CreditControlRequest</span>
</span><span id="__span-5-6"><span class="kn">from</span> <span class="nn">diameter.message.commands.credit_control</span> <span class="kn">import</span> <span class="n">RequestedServiceUnit</span>
</span><span id="__span-5-7"><span class="kn">from</span> <span class="nn">diameter.message.constants</span> <span class="kn">import</span> <span class="o">*</span>
</span><span id="__span-5-8"><span class="kn">from</span> <span class="nn">diameter.node</span> <span class="kn">import</span> <span class="n">Node</span>
</span><span id="__span-5-9"><span class="kn">from</span> <span class="nn">diameter.node.application</span> <span class="kn">import</span> <span class="n">SimpleThreadingApplication</span>
</span><span id="__span-5-10">
</span><span id="__span-5-11"><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(name)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-5-12"><span class="c1"># this shows a human-readable message dump in the logs</span>
</span><span id="__span-5-13"><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;diameter.peer.msg&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</span><span id="__span-5-14"><span class="c1"># this silences periodic dumping of peer statistics</span>
</span><span id="__span-5-15"><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;diameter.stats&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span><span id="__span-5-16">
</span><span id="__span-5-17">
</span><span id="__span-5-18"><span class="c1"># Configure our client node</span>
</span><span id="__span-5-19"><span class="n">node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
</span><span id="__span-5-20">    <span class="s2">&quot;smsgw.gy&quot;</span><span class="p">,</span> <span class="s2">&quot;testrealm.local&quot;</span><span class="p">,</span>
</span><span id="__span-5-21">    <span class="n">vendor_ids</span><span class="o">=</span><span class="p">[</span><span class="n">VENDOR_ETSI</span><span class="p">,</span> <span class="n">VENDOR_TGPP</span><span class="p">,</span> <span class="n">VENDOR_TGPP2</span><span class="p">])</span>
</span><span id="__span-5-22"><span class="c1"># Add the destination peer</span>
</span><span id="__span-5-23"><span class="n">ocs_cfg</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">add_peer</span><span class="p">(</span>
</span><span id="__span-5-24">    <span class="s2">&quot;aaa://ocs.gy&quot;</span><span class="p">,</span> <span class="s2">&quot;testrealm.local&quot;</span><span class="p">,</span>
</span><span id="__span-5-25">    <span class="n">ip_addresses</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;10.0.0.50&quot;</span><span class="p">],</span> <span class="n">is_persistent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-5-26"><span class="n">node</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="__span-5-27">
</span><span id="__span-5-28">
</span><span id="__span-5-29"><span class="c1"># Configure our client application</span>
</span><span id="__span-5-30"><span class="n">client</span> <span class="o">=</span> <span class="n">SimpleThreadingApplication</span><span class="p">(</span>
</span><span id="__span-5-31">    <span class="n">APP_DIAMETER_CREDIT_CONTROL_APPLICATION</span><span class="p">,</span>
</span><span id="__span-5-32">    <span class="n">is_auth_application</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-5-33"><span class="c1"># Add application for `ocs.gy` peer</span>
</span><span id="__span-5-34"><span class="n">node</span><span class="o">.</span><span class="n">add_application</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="p">[</span><span class="n">ocs_cfg</span><span class="p">])</span>
</span><span id="__span-5-35">
</span><span id="__span-5-36">
</span><span id="__span-5-37"><span class="c1"># Construct a credit control request</span>
</span><span id="__span-5-38"><span class="n">ccr</span> <span class="o">=</span> <span class="n">CreditControlRequest</span><span class="p">()</span>
</span><span id="__span-5-39">
</span><span id="__span-5-40"><span class="c1"># These are required:</span>
</span><span id="__span-5-41"><span class="n">ccr</span><span class="o">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">session_generator</span><span class="o">.</span><span class="n">next_id</span><span class="p">()</span>
</span><span id="__span-5-42"><span class="n">ccr</span><span class="o">.</span><span class="n">origin_host</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">origin_host</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="__span-5-43"><span class="n">ccr</span><span class="o">.</span><span class="n">origin_realm</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">realm_name</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="__span-5-44"><span class="n">ccr</span><span class="o">.</span><span class="n">destination_realm</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">realm_name</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="__span-5-45"><span class="n">ccr</span><span class="o">.</span><span class="n">auth_application_id</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">application_id</span>
</span><span id="__span-5-46"><span class="n">ccr</span><span class="o">.</span><span class="n">service_context_id</span> <span class="o">=</span> <span class="s2">&quot;32274@3gpp.org&quot;</span>
</span><span id="__span-5-47"><span class="n">ccr</span><span class="o">.</span><span class="n">cc_request_type</span> <span class="o">=</span> <span class="n">E_CC_REQUEST_TYPE_EVENT_REQUEST</span>
</span><span id="__span-5-48"><span class="n">ccr</span><span class="o">.</span><span class="n">cc_request_number</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-5-49">
</span><span id="__span-5-50"><span class="c1"># These are usually wanted by charging servers:</span>
</span><span id="__span-5-51"><span class="n">ccr</span><span class="o">.</span><span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;diameter&quot;</span>
</span><span id="__span-5-52"><span class="n">ccr</span><span class="o">.</span><span class="n">event_timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="__span-5-53"><span class="n">ccr</span><span class="o">.</span><span class="n">requested_action</span> <span class="o">=</span> <span class="n">E_REQUESTED_ACTION_DIRECT_DEBITING</span>
</span><span id="__span-5-54">
</span><span id="__span-5-55"><span class="n">ccr</span><span class="o">.</span><span class="n">add_subscription_id</span><span class="p">(</span>
</span><span id="__span-5-56">    <span class="n">subscription_id_type</span><span class="o">=</span><span class="n">E_SUBSCRIPTION_ID_TYPE_END_USER_E164</span><span class="p">,</span>
</span><span id="__span-5-57">    <span class="n">subscription_id_data</span><span class="o">=</span><span class="s2">&quot;41780000001&quot;</span><span class="p">)</span>
</span><span id="__span-5-58"><span class="n">ccr</span><span class="o">.</span><span class="n">add_multiple_services_credit_control</span><span class="p">(</span>
</span><span id="__span-5-59">    <span class="n">requested_service_unit</span><span class="o">=</span><span class="n">RequestedServiceUnit</span><span class="p">(</span><span class="n">cc_service_specific_units</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
</span><span id="__span-5-60">    <span class="n">service_identifier</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-5-61">
</span><span id="__span-5-62"><span class="c1"># Adds the following 3GPP vendor-specific AVP structure at the end, which</span>
</span><span id="__span-5-63"><span class="c1"># contains the SMS type and recipient. Looks like:</span>
</span><span id="__span-5-64"><span class="c1">#</span>
</span><span id="__span-5-65"><span class="c1">#   Service-Information &lt;Code: 0x369, Flags: 0xc0 (VM-), Length: 120, Vnd: TGPP&gt;</span>
</span><span id="__span-5-66"><span class="c1">#     SMS-Information &lt;Code: 0x7d0, Flags: 0x80 (V--), Length: 108, Vnd: TGPP&gt;</span>
</span><span id="__span-5-67"><span class="c1">#       Data-Coding-Scheme &lt;Code: 0x7d1, Flags: 0x80 (V--), Length: 16, Vnd: TGPP, Val: 8&gt;</span>
</span><span id="__span-5-68"><span class="c1">#       SM-Message-Type &lt;Code: 0x7d7, Flags: 0x80 (V--), Length: 16, Vnd: TGPP, Val: 0&gt;</span>
</span><span id="__span-5-69"><span class="c1">#       Recipient-Info &lt;Code: 0x7ea, Flags: 0x80 (V--), Length: 64, Vnd: TGPP&gt;</span>
</span><span id="__span-5-70"><span class="c1">#         Recipient-Address &lt;Code: 0x4b1, Flags: 0x80 (V--), Length: 52, Vnd: TGPP&gt;</span>
</span><span id="__span-5-71"><span class="c1">#           Address-Type &lt;Code: 0x383, Flags: 0xc0 (VM-), Length: 16, Vnd: TGPP, Val: 1&gt;</span>
</span><span id="__span-5-72"><span class="c1">#           Address-Data &lt;Code: 0x381, Flags: 0xc0 (VM-), Length: 23, Vnd: TGPP, Val: 41780000001&gt;</span>
</span><span id="__span-5-73"><span class="c1">#</span>
</span><span id="__span-5-74"><span class="c1"># Actual content wanted by the OCS on the receiving end may vary depending on</span>
</span><span id="__span-5-75"><span class="c1"># the vendor and their implementation.</span>
</span><span id="__span-5-76"><span class="n">ccr</span><span class="o">.</span><span class="n">append_avp</span><span class="p">(</span>
</span><span id="__span-5-77">    <span class="n">Avp</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">AVP_TGPP_SERVICE_INFORMATION</span><span class="p">,</span> <span class="n">VENDOR_TGPP</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-5-78">        <span class="n">Avp</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">AVP_TGPP_SMS_INFORMATION</span><span class="p">,</span> <span class="n">VENDOR_TGPP</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-5-79">            <span class="n">Avp</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">AVP_TGPP_DATA_CODING_SCHEME</span><span class="p">,</span> <span class="n">VENDOR_TGPP</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span>
</span><span id="__span-5-80">            <span class="n">Avp</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">AVP_TGPP_SM_MESSAGE_TYPE</span><span class="p">,</span> <span class="n">VENDOR_TGPP</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">E_SM_MESSAGE_TYPE_SUBMISSION</span><span class="p">),</span>
</span><span id="__span-5-81">            <span class="n">Avp</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">AVP_TGPP_RECIPIENT_INFO</span><span class="p">,</span> <span class="n">VENDOR_TGPP</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-5-82">                <span class="n">Avp</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">AVP_TGPP_RECIPIENT_ADDRESS</span><span class="p">,</span> <span class="n">VENDOR_TGPP</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-5-83">                    <span class="n">Avp</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">AVP_TGPP_ADDRESS_TYPE</span><span class="p">,</span> <span class="n">VENDOR_TGPP</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">E_ADDRESS_TYPE_MSISDN</span><span class="p">),</span>
</span><span id="__span-5-84">                    <span class="n">Avp</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">AVP_TGPP_ADDRESS_DATA</span><span class="p">,</span> <span class="n">VENDOR_TGPP</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;41780000002&quot;</span><span class="p">)</span>
</span><span id="__span-5-85">                <span class="p">]),</span>
</span><span id="__span-5-86">            <span class="p">]),</span>
</span><span id="__span-5-87">        <span class="p">])</span>
</span><span id="__span-5-88">    <span class="p">])</span>
</span><span id="__span-5-89"><span class="p">)</span>
</span><span id="__span-5-90">
</span><span id="__span-5-91"><span class="c1"># Wait for CER/CEA to complete</span>
</span><span id="__span-5-92"><span class="n">client</span><span class="o">.</span><span class="n">wait_for_ready</span><span class="p">()</span>
</span><span id="__span-5-93"><span class="n">cca</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">send_request</span><span class="p">(</span><span class="n">ccr</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-5-94">
</span><span id="__span-5-95"><span class="c1"># Should print 2001, if all goes well</span>
</span><span id="__span-5-96"><span class="nb">print</span><span class="p">(</span><span class="n">cca</span><span class="o">.</span><span class="n">result_code</span><span class="p">)</span>
</span><span id="__span-5-97">
</span><span id="__span-5-98"><span class="c1"># Disconnect from peer and exit</span>
</span><span id="__span-5-99"><span class="n">node</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span></code></pre></div>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.indexes", "toc.integrate"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>